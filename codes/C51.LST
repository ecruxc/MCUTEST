C51 COMPILER V9.00   C51                                                                   02/28/2019 11:33:48 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE C51
OBJECT MODULE PLACED IN C51.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE C51.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>                                //ͷļ
   2          #include"eeprom52.h"                      // EEPROM
   3          #define uchar unsigned char              //궨
   4          #define uint unsigned int                
   5          #define LCD1602_dat P0                    //LCD 1602 ݴIO
   6          
   7          sbit LCD1602_rs=P2^5;   //LCD1602IO                                //I/O 
   8          sbit LCD1602_rw=P2^6;   //I/O 
   9          sbit LCD1602_e=P2^7;
  10          
  11          
  12          sbit key_1=P1^3;                //IO
  13          sbit key_2=P1^4;
  14          sbit beep=P1^5;         //IO
  15          sbit led=P1^0;                  //ָʾƿIO
  16          
  17          
  18          unsigned long shu1,shu=1500;    //ƵʱƵƱ
  19          uchar ms,sec;       //50ms 
  20          uint cs;                    //ж
  21          
  22          bit OK,beep1;            //־λ
  23          /*
  24              1602Һǳõʾһ16ܽţа˸ܽݴܽţܽʹܶ˹
             -ţԴܽţ
  25          һԴܽǸҺйģһԴǵıԴʣµһܽǶԱȶȵڹ
             -ţһһ3K
  26          ٽӵؼɡ
  27          һõĺ޷Ǿ  LCD1602_write  LCD1602_writebyte
  28          LCD1602_write(x,y);   дݣһֻ 0  1 0˵ڶݶҺ
             -˵1˵
  29          ڶݶҺ˵Ҫʾݡ
  30          LCD1602_writebyte  ֱҪʾַɣԶʾ
  31           
  32           
  33          */
  34          /********************************************************************
  35          *  : delay()
  36          *  : Сʱ                                                                                                        
  37          *  : 
  38          *  : 
  39          ***********************************************************************/ 
  40          void delay(uint T)                                                         //ʱ
  41          {
  42   1              while(T--);
  43   1      }
  44          
  45          /********************************************************************
  46          *  : LCD1602_write(uchar order,dat)
  47          *  : 1602дݺ
  48          *  : ֵ
  49          *  : 
  50          ***********************************************************************/
  51          void LCD1602_write(uchar order,dat)                               //1602 һֽ  
  52          {
C51 COMPILER V9.00   C51                                                                   02/28/2019 11:33:48 PAGE 2   

  53   1          LCD1602_e=0;
  54   1          LCD1602_rs=order;
  55   1          LCD1602_dat=dat;
  56   1          LCD1602_rw=0;
  57   1          LCD1602_e=1;
  58   1          delay(10);
  59   1          LCD1602_e=0;                                                                                                                                                                                                     
  60   1      }
  61          /********************************************************************
  62          *  : LCD1602_writebye(uchar *prointer)
  63          *  : 1602дݺ  ָʽ
  64          *  : ֵ
  65          *  : 
  66          ***********************************************************************/
  67          void LCD1602_writebyte(uchar *prointer)                            //1602 ַ    
  68          {
  69   1          while(*prointer!='\0')
  70   1          {
  71   2              LCD1602_write(1,*prointer);
  72   2              prointer++;
  73   2          }
  74   1      }
  75          /********************************************************************
  76          *  : LCD1602_cls()
  77          *  : ʼ1602Һ 
  78          *  : 
  79          *  : 
  80          ***********************************************************************/
  81          void LCD1602_cls()                                                                       //1602 ʼ
  82          {
  83   1              LCD1602_write(0,0x01);     //1602  ָ
  84   1              delay(1500);
  85   1              LCD1602_write(0,0x38);     //  8λ5*7
  86   1              delay(1500);
  87   1              LCD1602_write(0,0x0c);     //    ʾءʾꡢַ˸
  88   1              LCD1602_write(0,0x06);
  89   1              LCD1602_write(0,0xd0);
  90   1              delay(1500);
  91   1      }
  92          /*
  93          ʾʱһĴ
  94          
  95              ȣʾҺʾʾʱԶһһʾģô˵һ123
             -һٶʮ
  96          ʾʱҪʾ1Ȼ2Ȼ3ôôȡ   
  97          ȡλ    123/100=1
  98          ȡʮλ    123/10=12      12%10=2     %ȡ˼1210ȡ࣬仰˵1210Ȼ
             -ȡ2
  99          ȡλ    123%10=3       ͬ
 100          
 101          ȡ÷Ҳкֻ֣ܶҪ֪ʱһ㶼ǽȡľ
 102          
 103          
 104          Ȼ
 105          ʾݣȡݷŵ͸IOɣ
 106          ҺʾҪתַΪҺַֻʾַݣ0Ӧַ0x301Ӧ
             -ַ0x31
 107          ԽȡֱӼ0x30͸Һɣ߼'0' Ҳһ 
 108          
 109          
 110           
 111          */
C51 COMPILER V9.00   C51                                                                   02/28/2019 11:33:48 PAGE 3   

 112          
 113          void show()
 114          {
 115   1              LCD1602_write(0,0x80);  //0
 116   1              LCD1602_writebyte("Now Freq:");  //ʾƵ
 117   1              LCD1602_write(1,0x30+shu1/100000%10);    //1
 118   1              LCD1602_write(1,0x30+shu1/10000%10);     //ΪҺֻʾַһ0x30ǿתַ
             -0x30ַ0
 119   1              LCD1602_write(1,0x30+shu1/1000%10);
 120   1              LCD1602_writebyte(".");
 121   1              LCD1602_write(1,0x30+shu1/100%10);
 122   1              LCD1602_writebyte("KHz");
 123   1      
 124   1              LCD1602_write(0,0xc0);          
 125   1              LCD1602_writebyte("SetFreq:");    //ʾƵ
 126   1              LCD1602_write(1,0x30+shu/1000%10);
 127   1              LCD1602_write(1,0x30+shu/100%10);
 128   1              LCD1602_write(1,0x30+shu/10%10);
 129   1              LCD1602_writebyte(".");
 130   1              LCD1602_write(1,0x30+shu%10); 
 131   1              LCD1602_writebyte("KHz");
 132   1      
 133   1      }
 134          /********************************************************************
 135          *  : key()
 136          *  : Ƴ                                                                                                    
 137          *  : 
 138          *  : 
 139          ***********************************************************************/
 140          
 141          /*
 142          
 143          ʲôƬʹö
 144          
 145          ڲ洢EEPROMͬĵƬʹ̻һ£Ƭڲкܶ洢Ԫ˵ÿһ
             -кַܶ
 146          ݾǴ洢Щַġ洢ĳǹٷṩõģЩֻҪһ
             -һ
 147          дһݶȡ
 148          ------ʹĸȶǸвдҪ׵ַ    SectorErase0x200
             -0;˵׵ַΪ0x2000  
 149          ݴ洢----------֮󣬾Ϳʹµĵַд洢        byte_write0x2000,123
             -;  ˵123洢0x2000ַ
 150          ݶȡ----------ֱӵüɣ     Dat=byte_read0x2000;˵0x2000ַµݶȡ  Dat
 151          
 152          
 153          ----
 154          //51Ƭ洢8λģҲ˵ܹµ 255Ǵһ256ͻһЩ
 155          //ԣҪ洢ݴ256ǾͰݲ𿪴   /256õλ    %256õλ֮256
             -Ϊ0-255,256
 156          // 257           257/256=1        257%256=1    ,ʹȥ1ȡʱ򣬽λݳ256ӵ
             -λݣԭ
 157          
 158          */
 159          
 160          void key()
 161          {
 162   1              if(OK==1)
 163   1              {
 164   2                      if(!key_1)   //жϰǷ
 165   2                      {
 166   3                              OK=0;
C51 COMPILER V9.00   C51                                                                   02/28/2019 11:33:48 PAGE 4   

 167   3                              if(sec==3)   //ִаӦĿ
 168   3                              {
 169   4                                      if(shu<3000) shu+=10;   //
 170   4                              }else
 171   3                              {
 172   4                                      if(shu<3000) shu+=1;    //̰
 173   4                              }
 174   3                              SectorErase(0x2000);     //ݵƬEEPROM
 175   3                              byte_write(0x2000,shu/256);
 176   3                              byte_write(0x2001,shu%256);     
 177   3      
 178   3                      }
 179   2              
 180   2                      if(!key_2)  //жϰǷ
 181   2                      {
 182   3                              OK=0;       //ִаӦĿ
 183   3                              if(sec==3)
 184   3                              {
 185   4                                      if(shu>200) shu-=10;//  
 186   4                              }else
 187   3                              {
 188   4                                      if(shu>200) shu-=1;       //̰
 189   4                              }
 190   3                              SectorErase(0x2000);     //ݵƬEEPROM
 191   3                              byte_write(0x2000,shu/256);
 192   3                              byte_write(0x2001,shu%256);
 193   3                      }
 194   2              }
 195   1              if(key_1==1&&key_2==1)  //жϰǷ
 196   1              {
 197   2                      sec=0;     //¼ʱ
 198   2              }
 199   1      }
 200          /********************************************************************
 201          *  : proc
 202          *  : ָʾƴ                                                                                                      
 203          *  : 
 204          *  : 
 205          ***********************************************************************/
 206          void proc()
 207          {
 208   1              if(shu1>=(shu*100)|shu1==0)
 209   1              {
 210   2                      led=0;
 211   2                      beep1=1;                
 212   2              }else
 213   1              {
 214   2                      led=1;
 215   2                      beep1=0;
 216   2              }
 217   1      }
 218          
 219          /********************************************************************
 220          *  : main()
 221          *  :                                                                                                   
 222          *  : 
 223          *  : 
 224          ***********************************************************************/ 
 225          void main()
 226          {
 227   1              uchar H,L;
 228   1              TMOD=0x51;  //ʱ0   ʽ0       ʱģʽ;   ʱ1   ʽ0  ģʽ
C51 COMPILER V9.00   C51                                                                   02/28/2019 11:33:48 PAGE 5   

 229   1              TH1=0;           //ʱ    ֵ  
 230   1              TL1=0;
 231   1              TL0 = 0xB0;             //öʱֵ
 232   1              TH0 = 0x3C;             //öʱֵ
 233   1              TR0=1;              //ʱ0ʱ
 234   1              TR1=1;                  //ʱ0
 235   1              EA=1;                   //ж
 236   1              ET0=1;                   //ʱ0ж
 237   1              ET1=1;                   //ʱ1ж
 238   1              H=byte_read(0x2000);   //ȡƬEEPROMб
 239   1              L=byte_read(0x2001);
 240   1              shu=H*256+L;
 241   1              if(shu>3000) shu=1500;  //ж϶Ƿȷ    ȷ    //¸ֵ
 242   1              LCD1602_cls();     //LCD1602ʼ
 243   1              while(1)
 244   1              {       
 245   2                      key();                     //ðƳ
 246   2                      show();                  //LCD1602Һʾ
 247   2                      proc();                  //ó
 248   2              }
 249   1      }
 250          
 251          void init_1() interrupt 1
 252          {
 253   1              TL0 = 0xB0;             //öʱֵ
 254   1              TH0 = 0x3C;             //öʱֵ
 255   1              ms++;              //50msʱ
 256   1              if(ms%4 ==0)      //ʱ  û200msһ
 257   1              {
 258   2                      OK=1;
 259   2              }
 260   1              if(ms%5==0)       //ָʾ˸
 261   1              {
 262   2                      if(beep1==1)
 263   2                      {
 264   3                              led=0;
 265   3                              beep=!beep;
 266   3                      }else
 267   2                      {
 268   3                          led=1;
 269   3                              beep=1;
 270   3                      }
 271   2              }
 272   1              if(ms>19)           //1sʱ  
 273   1              {
 274   2                      shu1=(long)cs*65535+TH1*256+TL1;        //Ƶ
 275   2                      cs=TH1=TL1=0;
 276   2                      ms=0;
 277   2                      if(!key_1||!key_2)         //
 278   2                      {
 279   3                              sec++;
 280   3                              if(sec>3)                //3sж
 281   3                              {
 282   4                                      sec=3;
 283   4                              }
 284   3                      }else
 285   2                      {
 286   3                              sec=0;
 287   3                      }
 288   2              }
 289   1      }
 290          
C51 COMPILER V9.00   C51                                                                   02/28/2019 11:33:48 PAGE 6   

 291          void init_3() interrupt 3  //ⲿжϼ⵱ǰƵ
 292          {
 293   1              cs++;   //ж
 294   1      }
 295          
 296          
 297          
 298          
 299          
 300          
 301          
 302          
 303          
 304          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1060    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     12       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
